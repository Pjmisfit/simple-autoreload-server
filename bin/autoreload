#!/usr/bin/env node

/*
 * simple-autoreload-server v0.0.7 - 2014-02-17
 * <https://github.com/cytb/simple-autoreload-server>
 *
 * Copyright (c) 2014 cytb
 *
 * Licensed under the MIT License License.
 * <http://www.opensource.org/licenses/mit-license.php>
 */

function partialize$(a,b,c){var d=this;return function(){var e,f=slice$.call(arguments),g=f.length,h=c.length,i=b?b.concat():[],j=c?c.concat():[];for(e=0;g>e;++e)i[j[0]]=f[e],j.shift();return h>g&&g?partialize$.apply(d,[a,i,j]):a.apply(d,i)}}var fs,minimist,options,utils,autoreload,cmdOptToMinimistOpt,usage,version,slice$=[].slice,join$=[].join;fs=require("fs"),minimist=require("minimist"),options=require("../lib/options"),utils=require("../lib/utils"),autoreload=require("../lib/autoreload"),cmdOptToMinimistOpt=function(a){var b,c,d,e,f,g,h,i,j,k,l;null==a&&(a={}),b={"boolean":[],string:[],alias:{},"default":{}};for(c in a){for(d=a[c],e=null!=(f=d.type)?f:null,g=null!=(f=d.short)?f:[],h=null!=(f=d.def)?f:null,i=e===String&&"string"||"boolean",b[i]=b[i].concat(c),j=0,k=(d=[].concat(g)).length;k>j;++j)l=d[j],b.alias[l]=[c];null!=h&&(b["default"][c]=h)}return b},usage=function(a){function b(a){return join$.call(a," ")}var c,d,e,f,g,h=[];c="autoreload",console.log("Usage:"),console.log(" ",c,"[options] [directory] [port]"),console.log(""),console.log("Options:");for(d in a)e=a[d],f=null!=e.short&&"-"+e.short||[],g=e.type===String&&"<param>"||[],partialize$.apply(console,[console.log,["  ",void 0],[1]])(b([join$.call(["--"+d].concat(f)," | ")].concat(g))),console.log("    ",e.desc),null!=e.def&&console.log("    ","default: "+e.def),h.push(console.log(""));return h},version=function(){var a,b;return a=utils.load(__dirname,"../package.json"),b=JSON.parse(a),console.log(""+b.name+" v"+b.version)},function(a){return a.call(this)}(function(){var a,b,c,d,e,f,g,h,i,j,k;return a=options.commandlineOptions,b=options.defaultModuleOptions,c=minimist(process.argv.slice(2),cmdOptToMinimistOpt(a)),c.version?(version(),!0):c.help?(version(),console.log(""),usage(a),!0):(d=c._,e=null!=(f=d[0])?f:c.root,g=null!=(f=d[1])?f:c.port,h=function(b){var d;if("string"==typeof c[b])try{return new RegExp(c[b])}catch(e){return d=e,a[b].def}},i=function(){var a,b,d,e,f,g,h,i,j,k,l,m;for(a=[].concat(c["inject-file"]),b=[].concat(c["inject-method"]),d=[].concat(c["inject-match-text"]),e=[].concat(c["inject-match-file"]),f=[],g=0,h=a.length;h>g;++g)i=a[g],j=e.shift(),null!=i&&null!=j&&(k=null!=(l=d.shift())?l:null,m=!/^a(p(p(e(n(d)?)?)?)?)$/.exec(b.shift()),f=f.concat({code:load(__dirname,i),match:k,file:j,prepend:m}));return f},j=c["no-default-script"]?[]:[b.inject],k=autoreload({root:e,port:g,watch:h("watch"),verbose:c.verbose,forceReload:h("force-reload")||b.forceReload,listDirectory:c["list-directory"],broadcastDelay:c.broadcastDelay,inject:j.concat(i())}))});